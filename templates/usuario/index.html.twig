{% extends 'base.html.twig' %}

{% block title %}Hello UsuarioController!
{% endblock %}

{% block body %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-4">
	<h3 class="mb-4">Registro de Usuario</h3>
	<form id="form-usuario">
		<div class="row g-3">

			<input type="hidden" id="id" name="id" value="0">
			<!-- Nombre -->
			<div class="col-md-6">
				<label for="nombre" class="form-label">Nombre</label>
				<input type="text" class="form-control" id="nombre" name="nombre" placeholder="Ingrese su nombre">
			</div>

			<!-- Cédula -->
			<div class="col-md-6">
				<label for="cedula" class="form-label">Cédula</label>
				<input type="text" class="form-control" id="cedula" name="cedula" placeholder="Ingrese su cédula">
			</div>

			<!-- Celular -->
			<div class="col-md-6">
				<label for="celular" class="form-label">Celular</label>
				<input type="tel" class="form-control" id="celular" name="celular" placeholder="Ingrese su celular">
			</div>

			<!-- Dirección -->
			<div class="col-md-6">
				<label for="direccion" class="form-label">Dirección</label>
				<input type="text" class="form-control" id="direccion" name="direccion"
					placeholder="Ingrese su dirección">
			</div>

			<!-- Fecha de nacimiento -->
			<div class="col-md-6">
				<label for="fecha_nacimiento" class="form-label">Fecha de nacimiento</label>
				<input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento">
			</div>

			<!-- EPS -->
			<div class="col-md-6">
				<label for="eps" class="form-label">EPS</label>
				<input type="text" class="form-control" id="eps" name="eps" placeholder="Ingrese su EPS">
			</div>

			<!-- Correo -->
			<div class="col-md-6">
				<label for="correo" class="form-label">Correo</label>
				<input type="email" class="form-control" id="correo" name="correo" placeholder="ejemplo@correo.com">
			</div>

		</div>

		<!-- Botón -->
		<div class="mt-4">
			<button type="submit" class="btn btn-primary">Guardar</button>
			<button id="reset-form-user" class="btn btn-secondary">Limpiar</button>
		</div>
	</form>
</div>
<div class="container mt-4">
	<h3 class="mb-4">Registro de Medidas Corporales</h3>
	<form>
		<div class="row g-3">

			<div class="col-md-4">
				<label for="cintura" class="form-label">Cintura (cm)</label>
				<input type="number" class="form-control" id="cintura" name="cintura" min="0">
			</div>

			<div class="col-md-4">
				<label for="gluteos" class="form-label">Glúteos (cm)</label>
				<input type="number" class="form-control" id="gluteos" name="gluteos" min="0">
			</div>

			<div class="col-md-4">
				<label for="brazo" class="form-label">Brazo (cm)</label>
				<input type="number" class="form-control" id="brazo" name="brazo" min="0">
			</div>

			<div class="col-md-4">
				<label for="pecho" class="form-label">Pecho (cm)</label>
				<input type="number" class="form-control" id="pecho" name="pecho" min="0">
			</div>

			<div class="col-md-4">
				<label for="pierna" class="form-label">Pierna (cm)</label>
				<input type="number" class="form-control" id="pierna" name="pierna" min="0">
			</div>

			<div class="col-md-4">
				<label for="pantorrilla" class="form-label">Pantorrilla (cm)</label>
				<input type="number" class="form-control" id="pantorrilla" name="pantorrilla" min="0">
			</div>
		</div>

		<!-- Botones -->
		<div class="mt-4">
			<button type="submit" class="btn btn-primary">Guardar</button>
			<button type="reset" class="btn btn-secondary">Limpiar</button>
		</div>
	</form>
</div>
<div class="container mt-4">
	<h3 class="mb-3">Lista de Usuarios</h3>
	<table id="table_usuarios" class="table table-bordered table-hover table-sm" data-toggle="table" data-search="true"
		data-pagination="true" data-page-size="5" data-page-list="[5, 10, 20, All]">
		<thead class="table-dark">
			<tr>
				<th data-field="id" data-sortable="true">ID</th>
				<th data-field="nombre" data-sortable="true">Nombre</th>
				<th data-field="cedula">Cédula</th>
				<th data-field="celular">Celular</th>
				<th data-field="direccion">Dirección</th>
				<th data-field="fecha_nacimiento">Fecha Nacimiento</th>
				<th data-field="eps">EPS</th>
				<th data-field="correo">Correo</th>
				<th data-field="code">Código</th>
				<th data-field="img" data-formatter="imgFormatter">Imagen</th>
				<th data-field="operate" data-formatter="accionesFormatter" data-events="operateEvents">Acciones</th>
			</tr>
		</thead>
	</table>
</div>

<script>

	document.addEventListener('DOMContentLoaded', function () { // Inicializar Bootstrap Table
		loadUsuarios();

	})


	function imgFormatter(value, row, index) {
		if (value) {
			return '<img src="' + value + '" alt="Imagen" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">';
		} else {
			return 'No disponible';
		}
	}

	function accionesFormatter(value, row, index) {
		return `
				<button class="btn btn-sm btn-primary editar" data-id="${row.id
			}"><i class='bi bi-pencil-square'></i></button>
				<button class="btn btn-sm btn-danger eliminar" data-id="${row.id
			}"><i class="bi bi-trash"></i></button>
			`;
	}

	// enviar formulario de usuario
	document.getElementById('form-usuario').addEventListener('submit', function (event) {
		event.preventDefault();
		const formData = new FormData(this);
		fetch('{{ path('app_usuario_registro') }}', {
			method: 'POST',
			body: formData
		}).then(response => response.json()).then(data => {
			if (data.status === 'success') {
				Swal.fire({ title: '¡Éxito!', text: 'El usuario fue guardado correctamente', icon: 'success', confirmButtonText: 'Aceptar' });

				// recargar tabla de usuarios
				loadUsuarios();
				// resetear formulario
				resetForm();
			} else {

				Swal.fire({ title: '¡Error!', text: data.message, icon: 'error', confirmButtonText: 'Aceptar' });


			}
		}).catch(error => {
			Swal.fire({ title: '¡Error!', text: error.message, icon: 'error', confirmButtonText: 'Aceptar' });
		});
	});


	// listar usuarios en la tabla
	function loadUsuarios() {

		fetch('{{ path('app_usuario_listar') }}').then(response => response.json()).then(data => {
			$('#table_usuarios').bootstrapTable('load', data);
		}).catch(error => {
			console.error('Error al cargar los usuarios:', error.message);
		});
	}
	// editar usuario desde la tabla bostratable
	// Evento para botón editar
	window.operateEvents = {
		'click .editar': (e, value, row) => { // Llenar el formulario con los datos del usuario
			document.getElementById('id').value = row.id;
			document.getElementById('nombre').value = row.nombre;
			document.getElementById('cedula').value = row.cedula;
			document.getElementById('celular').value = row.celular;
			document.getElementById('direccion').value = row.direccion;
			document.getElementById('fecha_nacimiento').value = row.fecha_nacimiento;
			document.getElementById('eps').value = row.eps;
			document.getElementById('correo').value = row.correo;

			// Desplazar la vista hacia el formulario
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}
	}

	function resetForm() {
		document.getElementById('form-usuario').reset();
		document.getElementById('id').value = 0;
	}
	document.getElementById('reset-form-user').addEventListener('click', function (event) {
		event.preventDefault();
		resetForm();
	});
</script>
{% endblock %}